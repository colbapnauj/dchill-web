<html>

<body>

   <h1>
    Cálculo salario mensual
   </h1>

   <span id="resultado"></span>

   <br>
   <button id="mainButton">Ingresar datos</button>




</body>

    <script type="module">



    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import {
  getDatabase,
  ref,
  set,
  get,
  push,
  onValue
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {

apiKey: "AIzaSyCHNGgCmB49K5wvLZ9e9jwwaobXxSeow4I",

authDomain: "abcorp-net-pe.firebaseapp.com",

databaseURL: "https://abcorp-net-pe-default-rtdb.europe-west1.firebasedatabase.app",

projectId: "abcorp-net-pe",

storageBucket: "abcorp-net-pe.firebasestorage.app",

messagingSenderId: "665084896762",

appId: "1:665084896762:web:1bedb1e738f4411d477043",

measurementId: "G-SJR8YMJZPJ"

};


// Inicializar Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
    
    function calcularSalarioMensual(valorInicial) {

        console.log(valorInicial)

        let horasTrabajas = null
        if (valorInicial === null || typeof valorInicial === 'undefined') {
            horasTrabajas = prompt('Cuántas horas trabajaste')

            if (horasTrabajas === null) {
                return
            }

            horasTrabajas = horasTrabajas.trim()
        } else {
            horasTrabajas = valorInicial
        }

        console.log(horasTrabajas)

        

        if (horasTrabajas === '') {
            alert('Ingresa un valor')
            calcularSalarioMensual()
            return;
        }
        
        horasTrabajas = Number(horasTrabajas)
        const esUnNumero = (horasTrabajas * 0) === 0

        if (esUnNumero === false) {
            alert('Ingresa un valor válido')
            calcularSalarioMensual()
            return;
        }

        if (horasTrabajas <= 0) {
            alert('Ingresa un valor mayor a cero')
            calcularSalarioMensual()
            return;
        }

        // mañana, tarde, noche
        const turno = prompt(`Horas trabajadas: ${horasTrabajas}\nqué turno (mañana, tarde, noche),`)

        console.log(turno)

        if (turno == null) {
            return;
        }

        if (turno === '') {
            alert('Debes ingresar un valor')
        }

        const turnosPermitidos = ['mañana', 'tarde', 'noche']

        if (!turnosPermitidos.includes(turno)) {
            calcularSalarioMensual(horasTrabajas)
            return;
        }

        

        const tarifaHoraria = 37

        let tarifaHorariaPorTurno = 0

        // determina sueldo bruto 
        switch (turno) {
            case 'mañana':
                console.log('estoy aqui')
                tarifaHorariaPorTurno = tarifaHoraria
                break
            case 'tarde':
                console.log('aqui tambien')
                tarifaHorariaPorTurno = tarifaHoraria * 1.2
                break
            case 'noche':
                console.log('y aquiii')
                tarifaHorariaPorTurno = tarifaHoraria * 1.5
                break
        }

        // calcular sueldo bruto
        const sueldoBruto = horasTrabajas * tarifaHorariaPorTurno
        let descuento = 0
        let hayBug = false

        if (turno == 'noche') {
            if (sueldoBruto >= 2000 && sueldoBruto <= 5000) {
                descuento = sueldoBruto * 0.15
            }

            if (sueldoBruto > 5000 && sueldoBruto < 8000) {
                hayBug = true
                console.log('APROVECHA EL BUG!')
            }

            if (sueldoBruto >= 8000 && sueldoBruto <= 10000) {
                descuento = sueldoBruto * 0.17
            }
        }

        const salario = sueldoBruto - descuento


        console.log(`Sueldo bruto ${sueldoBruto}`)
        console.log(`Tarifa horaria por turno ${tarifaHorariaPorTurno}`)
        console.log(`Descuento ${descuento}`)

        console.log(`Este mes vas a cobrar ${salario}`)

        const text = 
        `Sueldo bruto: ${sueldoBruto}\n` +
        `Tarifa horaria por turno: ${tarifaHorariaPorTurno}\n` +
        `${(hayBug ? 'APROVECHA EL BUG\n' : '')}` +
        `Descuento: ${(descuento == 0 ? '' : '-')}${descuento}\n` +
        `Este mes vas a cobrar: ${salario}\n`

        document.getElementById('resultado').innerText = text

        const resgistro = localStorage.getItem('registro')
        if (resgistro)
        localStorage.setItem('registro', resgistro + '\n\n' + text)

        
        set(ref(db, 'salarios'), {
            text
        })


        

        
        let buttonEl = document.getElementById('mainButton')
        if (numeroDeEjecucion % 2 == 0) {
            buttonEl.innerText = 'Nuevo cálculo'
        } else {
            buttonEl.innerText = 'Otro cálculo'
        }

    }

    const resgistro = localStorage.getItem('registro')
    document.getElementById('resultado').innerText = resgistro


    let numeroDeEjecucion = 0

    document.getElementById('mainButton').addEventListener('click', function() {
        ++numeroDeEjecucion
        calcularSalarioMensual()

        console.log(numeroDeEjecucion)
    })
    
    </script>
</html>